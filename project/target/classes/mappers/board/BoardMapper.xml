<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.board.mapper.BoardMapper">

	<select id="getList" resultType="boardVO">
		SELECT BNO, TITLE, CONTENT, USER_ID, REGDATE, UPDATEDATE, SECRET 
		FROM
		(	
			SELECT  /*+ INDEX_DESC(TBL_BOARD) */ 
			ROWNUM RN, BNO, TITLE, CONTENT, USER_ID, REGDATE, UPDATEDATE, SECRET 
			FROM TBL_BOARD 
			<![CDATA[	
			WHERE ROWNUM <= ${pageNum} * #{amount}
			]]>	
		)
			<!-- where 절이 먼저 되기 때문에 where 절에서 rn 을 쓸 수 없음 -->
			<!-- 해당 페이지 마지막 게시글 번호   -->
		<![CDATA[	
		WHERE RN > (#{pageNum}-1) * #{amount} 
		]]>
		<!-- 해당 페이지 시작 번호  -->
	</select>

	<insert id="insert" parameterType="boardVO">
	<!-- parameter 는 생략 가능 :Mapper 에서 연결된 걸로 가져옴   -->
	<selectKey keyProperty="bno" order="BEFORE" resultType="long">
		SELECT NVL(MAX(BNO),0)+1 FROM TBL_BOARD
	</selectKey>
		INSERT INTO TBL_BOARD(BNO, TITLE, CONTENT, USER_ID, SECRET)
		VALUES( #{bno}
				, #{title}
				, #{content}
				, #{user_id}
				, #{secret})
	</insert>
	
	<select id="read" parameterType="long" resultType="boardVO">
	<!-- parameter 는 생략 가능 :Mapper 에서 연결된 걸로 가져옴   -->
		SELECT * FROM TBL_BOARD
		WHERE BNO = #{bno}
	</select>
		
	<delete id="delete">
		DELETE FROM TBL_BOARD WHERE BNO = #{bno}
	</delete>

	<update id="update">
		UPDATE TBL_BOARD
		SET   TITLE = #{title}
			, CONTENT = #{content}
			, USER_ID = #{user_id}
			, UPDATEDATE = SYSDATE
			, SECRET =#{secret}
		WHERE BNO = #{bno}
	</update>
	
	<select id="getTotal" resultType="_int">
		SELECT COUNT(BNO) FROM TBL_BOARD
	</select>
	
</mapper>
